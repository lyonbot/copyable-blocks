var J=Object.defineProperty,j=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var F=(n,t,e)=>t in n?J(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,S=(n,t)=>{for(var e in t||(t={}))$.call(t,e)&&F(n,e,t[e]);if(I)for(var e of I(t))q.call(t,e)&&F(n,e,t[e]);return n},O=(n,t)=>j(n,G(t));import{D as A,F as w,p as U,v as c,T as V,s as B,y as E,g as K,d as C,A as k,_ as z,l as X,S as Q}from"./vendor.962ffbf4.js";const Y=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}};Y();const Z=()=>[{name:"aaa"},{name:"bbb",children:[{name:"b1"},{name:"b2"}]},{name:"ccc"}],tt=(n,t)=>{if("__demo_wholeReplace__"in t)return t.__demo_wholeReplace__;const e=[...n];let o=e,i=null;return t.path.forEach(s=>{const l=o[s],a=O(S({},l),{children:[...l.children||[]]});o[s]=a,i=a,o=a.children}),t.rename&&i&&(i.name=t.rename.name),t.insert&&o.splice(t.insert.index,0,...t.insert.items),t.remove&&[...t.remove.indexes].sort((s,l)=>l-s).forEach(s=>o.splice(s,1)),console.log("store reducer called",t,e),e},L=A(null),et=n=>{const t=U(tt,null,Z);return c(L.Provider,{value:t},n.children)},y=()=>w(L);function P(){return P=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},P.apply(this,arguments)}const T=(n,t)=>typeof n=="function"?n(t):n;class st{get activeNumber(){return this._activeNumber}get isActive(){return this._activeNumber!==!1}setSelectStatus(t){var e,o;return this._activeNumber!==t&&(this._activeNumber=t,(e=(o=this.info).onActiveStatusChange)==null||e.call(o,this),!0)}constructor(t,e,o){this.type="block",this.ctx=void 0,this.ownerSlot=void 0,this.slots=new Set,this.info=void 0,this._activeNumber=!1,this.handlePointerUp=()=>this.ctx.handleBlockPointerUp(this,!1),this.handlePointerUpCapture=()=>this.ctx.handleBlockPointerUp(this,!0),this.ctx=t,this.ownerSlot=e,e&&e.items.add(this),this.info=o}get index(){return T(this.info.index,this)}get data(){return T(this.info.data,this)}createSlot(t){return this.ctx.createSlot(t,this)}dispose(){var t;this.ctx.activeBlocks.has(this)&&(this.ctx.activeBlocks.delete(this),this.ctx.syncActiveElementStatus()),(t=this.ownerSlot)==null||t.items.delete(this),this.slots.forEach(e=>e.dispose()),this.slots.clear()}}function g(n){if(n)return n[Symbol.iterator]().next().value}class it{constructor(t,e,o){this.type="slot",this.ctx=void 0,this.ownerBlock=void 0,this.items=new Set,this.info=void 0,this.handlePointerUp=()=>this.ctx.handleSlotPointerUp(this),this.handlePointerUpCapture=()=>this.ctx.handleSlotPointerUp(this,!0),this._isActive=!1,this.ctx=t,this.ownerBlock=e,e&&e.slots.add(this),this.info=o}createBlock(t){return this.ctx.createBlock(t,this)}get isActive(){return this._isActive}setActive(t){var e,o;return this._isActive!==t&&(this._isActive=t,(e=(o=this.info).onActiveStatusChange)==null||e.call(o,this),!0)}dispose(){var t;let e=!1;this.ctx.slotOfActiveBlocks===this&&(this.ctx.activeBlocks.clear(),e=!0),this.ctx.activeSlot===this&&(this.ctx.activeSlot=null,e=!0),e&&this.ctx.syncActiveElementStatus(),(t=this.ownerBlock)==null||t.slots.delete(this),this.items.forEach(o=>o.dispose()),this.items.clear()}}const ot={deactivateHandlersWhenBlur:!0,navigateWithArrowKeys:!0,handleDeleteKey:!0,multipleSelect:!0};class nt extends V{constructor(t={}){super(),this.hiddenInput=void 0,this._lastActiveElement=null,this.hasFocus=!1,this.options=void 0,this.activeBlocks=new Set,this.slotOfActiveBlocks=null,this.activeSlot=null,this.lastActiveSlot=null,this.lastActiveBlocks=void 0,this.isFocusingBlock=void 0,this.isFocusingSlot=void 0,this.handleSlotPointerUp=(i,s)=>{!s&&this.isFocusingSlot||(this.isFocusingSlot=i)},this.handleBlockPointerUp=(i,s)=>{!s&&this.isFocusingBlock||(this.isFocusingBlock=i)},this.handleGlobalPointerUp=i=>{const s=this.isFocusingBlock,l=this.options.multipleSelect;let a=this.isFocusingSlot;if(this.isFocusingBlock=void 0,this.isFocusingSlot=void 0,s)if(l&&(i.ctrlKey||i.metaKey))s.ownerSlot!==this.slotOfActiveBlocks&&this.activeBlocks.clear(),this.activeBlocks.add(s),a=s.ownerSlot||void 0;else if(l&&i.shiftKey){const r=s.ownerSlot;r!==this.slotOfActiveBlocks&&this.activeBlocks.clear();const u=s.index;let h=u,m=u;this.activeBlocks.forEach(p=>{const d=p.index;h>d&&(h=d),m<d&&(m=d)}),r?(this.activeBlocks.clear(),r.items.forEach(p=>{const d=p.index;d>=h&&d<=m&&this.activeBlocks.add(p)})):this.activeBlocks.add(s)}else this.activeBlocks.clear(),this.activeBlocks.add(s);else this.options.deactivateHandlersWhenBlur&&this.activeBlocks.size>0&&this.activeBlocks.clear();this.activeSlot=a||null,this.syncActiveElementStatus()},this.options=P({},ot,t),document.addEventListener("pointerup",this.handleGlobalPointerUp,!1);const e=this.hiddenInput=document.createElement("textarea");e.style.cssText="opacity:0;left:0;top:0;position:fixed;width:2px;height:2px",e.tabIndex=-1,e.ownerDocument.body.appendChild(e);const o=i=>{var s;const l={isCBClipboardData:!0,blocksData:[]};this.activeBlocks.forEach(a=>{l.blocksData.push(a.data)}),l.blocksData.length!==0&&(i.preventDefault(),(s=i.clipboardData)==null||s.setData("text/plain",JSON.stringify(l)))};e.addEventListener("copy",i=>{o(i)},!1),e.addEventListener("cut",i=>{o(i),this.deleteActiveBlocks()},!1),e.addEventListener("paste",i=>{i.preventDefault();try{var s;const l=(s=i.clipboardData)==null?void 0:s.getData("text/plain");if(!l)return;const a=JSON.parse(l);if(!a.isCBClipboardData)throw new Error("Invalid CBClipboardData");const r=g(this.activeBlocks),u=this.activeSlot;if(u){const h=u,m=h===(r==null?void 0:r.ownerSlot)?r.index:Math.max(0,...Array.from(h.items.values(),d=>1+d.index)),p={type:"paste",ctx:this,data:a,slot:h,index:m};u.info.onPaste==null||u.info.onPaste(p),this.emit("paste",p),setTimeout(()=>{const d=a.blocksData.length+m-1,v=Array.from(h.items).filter(f=>f.index>=m&&f.index<=d);v.length&&(this.activeSlot=h,this.activeBlocks.clear(),v.forEach(f=>this.activeBlocks.add(f)),this.syncActiveElementStatus())},100)}}catch(l){console.error("Failed to paste!",l)}},!1),e.addEventListener("focus",()=>{this.hasFocus=!0,this.emit("focus",this)},!1),e.addEventListener("blur",()=>{this.hasFocus=!1,this._lastActiveElement=null,this.emit("blur",this)},!1),e.addEventListener("keydown",i=>{const s=this.options;switch(i.code){case"ArrowUp":s.navigateWithArrowKeys&&this.activeNextBlock(-1,i.shiftKey||i.ctrlKey||i.metaKey);break;case"ArrowDown":s.navigateWithArrowKeys&&this.activeNextBlock(1,i.shiftKey||i.ctrlKey||i.metaKey);break;case"ArrowLeft":s.navigateWithArrowKeys&&this.activeParentBlock();break;case"ArrowRight":s.navigateWithArrowKeys&&this.activeChildrenBlocks();break;case"Delete":case"Backspace":s.handleDeleteKey&&this.deleteActiveBlocks();break;case"Tab":{const l=this._lastActiveElement;if(l&&"focus"in l){const a=l.tabIndex===-1&&l.querySelector("[tabIndex], button, textarea, input, select, a, [contentEditable]");a&&"focus"in a?a.focus():l.focus()}i.preventDefault()}}},!1)}focus(){document.activeElement!==this.hiddenInput&&(this._lastActiveElement=document.activeElement,this.hiddenInput.focus())}copy(){this.hiddenInput.focus(),document.execCommand("copy")}deleteActiveBlocks(){var t;const e=Array.from(this.activeBlocks.values()),o=(t=e[0])==null?void 0:t.ownerSlot;if(!o)return;const i={type:"cut",blocks:e,ctx:this,slot:o};o.info.onCut==null||o.info.onCut(i),this.emit("cut",i)}activeNextBlock(t,e=!1){const o=e&&this.options.multipleSelect;this.focus();let i=!0,s=Array.from(this.activeBlocks);var l;if(!s.length&&(s=Array.from(((l=this.activeSlot)==null?void 0:l.items)||[]),i=!1,!s.length))return;const a=s[0].ownerSlot;let r=s[0].index,u=r,h=s[0],m=h;s.slice(1).forEach(v=>{if(v.ownerSlot!==a)return;const f=v.index;f>r&&(r=f,h=v),f<u&&(u=f,m=v)});const p=t>0?r+t:u+t,d=function(v,f){if(!!v){for(const D of v)if(f(D))return D}}(a==null?void 0:a.items,v=>v.index===p);d?(o||this.activeBlocks.clear(),this.activeBlocks.add(d),this.activeSlot=a,this.syncActiveElementStatus()):i?o||(this.activeBlocks.clear(),s.length>1&&this.activeBlocks.add(t>0?h:m),this.syncActiveElementStatus()):(this.activeBlocks.clear(),o?s.forEach(v=>this.activeBlocks.add(v)):this.activeBlocks.add(t>0?m:h),this.syncActiveElementStatus())}activeParentBlock(){var t;const e=(t=this.activeSlot)==null?void 0:t.ownerBlock;this.activeSlot=(e==null?void 0:e.ownerSlot)||null,this.activeBlocks.clear(),e&&this.activeBlocks.add(e),this.syncActiveElementStatus()}activeChildrenBlocks(){const t=g(this.activeBlocks),e=g(t==null?void 0:t.slots);if(e){if(this.activeSlot=e,this.activeBlocks.clear(),this.options.multipleSelect)e.items.forEach(o=>this.activeBlocks.add(o));else{const o=g(e.items);o&&this.activeBlocks.add(o)}this.syncActiveElementStatus()}}syncActiveElementStatus(){var t;let e=!1;const o=this.lastActiveBlocks,i=this.lastActiveSlot,s=Array.from(this.activeBlocks),l=((t=s[0])==null?void 0:t.ownerSlot)||null;var a;s.length>1&&l!==this.activeSlot&&(this.activeSlot=l),!this.activeSlot&&l&&(this.activeSlot=l),s.forEach((r,u)=>{o==null||o.delete(r),e=r.setSelectStatus(u)||e}),o==null||o.forEach(r=>{e=r.setSelectStatus(!1)||e}),this.activeSlot!==i&&(i==null||i.setActive(!1),(a=this.activeSlot)==null||a.setActive(!0),this.lastActiveSlot=this.activeSlot,e=!0),this.lastActiveBlocks=new Set(this.activeBlocks),this.slotOfActiveBlocks=l,e&&this.emit("activeElementChanged",this)}dispose(){var t;(t=this.hiddenInput.parentElement)==null||t.removeChild(this.hiddenInput),document.removeEventListener("pointerup",this.handleGlobalPointerUp,!1)}createBlock(t,e=null){return new st(this,e,t)}createSlot(t,e=null){return new it(this,e,t)}}const M=A(null),H=()=>w(M),lt=M.Provider,x=A(null);x.displayName="OwnerSlot";const ct=()=>w(x),at=x.Provider;x.Consumer;const N=n=>{const t=B(n);t.current=n,E(()=>()=>t.current(),[])},W=()=>{const[,n]=U(t=>(t+1)%16777215,0);return n},rt=n=>S({},n),ht=n=>S({},n),_=n=>{const t=[];for(;n;)t.unshift(n.index),n=n.ownerSlot.ownerBlock;return t},b=(...n)=>n.filter(t=>!!t).map(t=>Array.isArray(t)?b(t):String(t)).join(" "),R=K(function(t){var u;const e=t.ownerBlock||null,[,o]=y(),i=W(),s=H(),l=C(()=>s.createSlot({onCut:h=>o({path:_(e),remove:{indexes:h.blocks.map(m=>m.index)}}),onPaste:h=>o({path:_(e),insert:{index:h.index,items:h.data.blocksData.map(rt)}}),onActiveStatusChange:()=>i()},e),[]);N(()=>l.dispose());const a=k(h=>{l.handlePointerUp(),document.activeElement===h.currentTarget&&l.ctx.focus()},[]),{isActive:r}=l;return c("div",{className:b("mySlot",r&&"isActive"),tabIndex:-1,onPointerUp:a},c(at,{value:l},((u=t.children)==null?void 0:u.length)>0?t.children:c("div",{className:"mySlot-emptyPlaceholder"},"Nothing")))}),ut=K(function n(t){var p;const{index:e,item:o}=t,i=W(),s=B();z(s,()=>({index:e,item:o}),[e,o]);const l=H(),a=ct(),r=C(()=>l.createBlock({data:()=>ht(s.current.item),index:()=>s.current.index,onActiveStatusChange:()=>i()},a),[]);N(()=>r.dispose());const u=k(d=>{r.handlePointerUp(),document.activeElement===d.currentTarget&&r.ctx.focus()},[]),{activeNumber:h,isActive:m}=r;return c("div",{className:b("myBlock",m&&"isActive"),tabIndex:-1,onPointerUp:u},m&&c("div",{className:"myBlock-selectIndex"},h+1),c(dt,{name:o.name,blockHandler:r}),c(R,{ownerBlock:r},((p=o.children)==null?void 0:p.length)?o.children.map((d,v)=>c(n,{key:v,index:v,item:d})):null))}),dt=n=>{const[,t]=y(),e=k(o=>{const i=n.blockHandler,s=_(i),l=o.currentTarget.value;t({path:s,rename:{name:l}})},[]);return c("input",{className:"blockNameInput",type:"text",value:n.name,onChange:e})},vt=()=>{const[n,t]=y(),e=B(null);E(()=>{e.current.value=JSON.stringify(n,null,2)},[n]);const o=B(null);o.current=n;const i=k((a=!0)=>{try{const r=JSON.parse(e.current.value);t({path:[],__demo_wholeReplace__:r})}catch(r){a&&(e.current.value=JSON.stringify(o.current,null,2)),console.error("Failed to replace: ",r)}},[]),s=k(()=>i(!0),[]),l=k(()=>i(!1),[]);return c("div",null,c("ul",null,c("li",null,"Click and select block / slot"),c("li",null,"Copy, Cut, Paste with ",c("kbd",null,"Ctrl+C")," / ",c("kbd",null,"Ctrl+X")," / ",c("kbd",null,"Ctrl+V")),c("li",null,"Navigate between blocks with arrow keys"),c("li",null,"Select multiple blocks with ",c("kbd",null,"Ctrl")," or ",c("kbd",null,"Shift"))),c("h3",null,"Current Store"),c("textarea",{class:"demoPage-store",spellcheck:!1,ref:e,onBlur:s,onInput:l}))},mt=function(){const[n]=y(),[t,e]=X(!1),o=C(()=>new nt,[]);return N(()=>o.dispose()),E(()=>{o.on("focus",()=>e(!0)),o.on("blur",()=>e(!1)),o.on("paste",i=>{console.log("pasting...",i)})},[]),c(lt,{value:o},c("h2",null,"CopyableBlocks"),c("div",{className:b("demoPage",t&&"hasFocus")},c("div",{className:"demoPage-blockArea"},c(R,null,n.map((i,s)=>c(ut,{key:s,index:s,item:i})))),c("div",{className:"demoPage-introductionArea"},c(vt,null))))};Q(c(et,null,c(mt,null)),document.getElementById("app"));
