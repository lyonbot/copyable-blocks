var q=Object.defineProperty,z=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable;var N=(l,t,e)=>t in l?q(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,k=(l,t)=>{for(var e in t||(t={}))Z.call(t,e)&&N(l,e,t[e]);if(_)for(var e of _(t))tt.call(t,e)&&N(l,e,t[e]);return l},F=(l,t)=>z(l,Q(t));import{D as C,F as T,p as U,v as a,s as b,y as I,g as K,d as y,A as S,_ as et,l as ot,a as it,S as st}from"./vendor.f49ce37a.js";const nt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}};nt();function H(){return H=Object.assign||function(l){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(l[o]=e[o])}return l},H.apply(this,arguments)}const L=(l,t,e)=>{const o=l._listeners;o[t]?o[t].push(e):o[t]=[e]};class ${constructor(){this._listeners={}}on(t,e){return L(this,t,{listener:e}),this}once(t,e){return L(this,t,{listener:e,once:!0}),this}off(t,e){const o=this._listeners[t];if(!o)return this;if(o.length===1&&e===o[0].listener)return this._listeners[t]=null,this;const i=o.findIndex(s=>s.listener===e);return i!==-1&&o.splice(i,1),this}emit(t,...e){const o=this._listeners[t];if(!o)return;let i=!1;o.forEach(s=>{s.listener(e),s.once&&(i=!0)}),i&&(this._listeners[t]=o.filter(s=>!s.once))}removeAllListeners(){return this._listeners={},this}}function lt(l){return!(typeof l!="object"||!l||l.isIBClipboardData!==!0||"ibContextUUID"in l&&typeof l.ibContextUUID!="string"||!Array.isArray(l.blocksData)||l.blocksData.some(t=>typeof t!="object"||t===null))}const B=()=>function(l){Object.assign(this,l),this.returnValue=!0,this.preventDefault=()=>{this.returnValue=!1}},rt=B(),ct=B(),at=B(),ht=B(),dt=B(),ut=B(),M=(l,t)=>typeof l=="function"?l(t):l;class vt{get activeNumber(){return this._activeNumber}get isActive(){return this._activeNumber!==!1}get ref(){return this.info.ref}setSelectStatus(t){var e,o;return this._activeNumber!==t&&(this._activeNumber=t,(e=(o=this.info).onActiveStatusChange)==null||e.call(o,this),!0)}constructor(t,e,o){this.type="block",this.ctx=void 0,this.ownerSlot=void 0,this.slots=new Set,this.info=void 0,this._activeNumber=!1,this.handlePointerUp=()=>this.ctx.handleBlockPointerUp(this,!1),this.handlePointerUpCapture=()=>this.ctx.handleBlockPointerUp(this,!0),this.ctx=t,this.ownerSlot=e,e&&e.items.add(this),this.info=o}get index(){return M(this.info.index,this)}get data(){return M(this.info.data,this)}createSlot(t){return this.ctx.createSlot(t,this)}dispose(){var t;this.ctx.activeBlocks.has(this)&&(this.ctx.activeBlocks.delete(this),this.ctx.syncActiveElementStatus()),(t=this.ownerSlot)==null||t.items.delete(this),this.slots.forEach(e=>e.dispose()),this.slots.clear(),this.info=ft}}const ft={index:()=>{throw new Error("Accessing a disposed block")},data:()=>{throw new Error("Accessing a disposed block")}};function gt(l,t){let e,o;function i(n=!1){e&&(n&&o&&l(...o),clearTimeout(e),e=null,o=void 0)}const s=function(...n){o=n,e||(e=setTimeout(()=>i(!0),t))};return s.cancel=()=>i(!1),s.flush=()=>i(!0),s}function P(l,t){const e=t.map(o=>l[o]).filter(o=>o!==void 0);return[...t].sort((o,i)=>i-o).forEach(o=>l.splice(o,1)),e}function pt(l,t,e){const o=P(l,t);l.splice(e,0,...o)}function mt(l,t,e,o){const i=P(l,t);e.splice(o,0,...i)}function V(l,t){if(t==="camelCase")return l;const e={};return Object.keys(l).forEach(o=>{var i;let s=o;t==="react"&&(s=`on${(i=s[0])==null?void 0:i.toUpperCase()}${s.substr(1)}`),t==="lowercase"&&(s=s.toLowerCase()),e[s]=l[o]}),e}function W(l,t){if(!l)return;let e=0;for(const o of l){if(t(o,e))return o;e+=1}}function w(l){if(l)return l[Symbol.iterator]().next().value}const kt="webkitRequestAnimationFrame"in window,p=document.createElement("div");p.style.cssText="position:fixed;pointer-events:none;left:0;top:0;background: #FFF; border: 1px solid #000; padding: 4px 8px;transform:translate(-50%, -50%)";class St extends ${constructor(t){super(),this.ctx=void 0,this.draggingBlocks=void 0,this.slotOfDraggingBlocks=void 0,this.isHovering=!1,this.hoveringSlot=void 0,this.hoveringBlock=void 0,this.dropEffect=void 0,this.setHoveringSlot=gt(this._originalSetHoveringSlot.bind(this),50),this.ctx=t}dispose(){this.removeAllListeners(),this.setHoveringSlot.cancel()}_originalSetHoveringSlot(t,e){var o;if(t&&typeof e!="number")throw new Error("Cannot setHoveringSlot with indexToDrop unknown");if(t===this.hoveringSlot)return void(t&&t.indexToDrop!==e&&(t.indexToDrop=e,t.info.onDragHoverStatusChange==null||t.info.onDragHoverStatusChange(this.ctx),this.emit("hoverChanged",this.ctx)));const i=this.hoveringSlot;((o=this.hoveringBlock)==null?void 0:o.ownerSlot)!==t&&(this.hoveringBlock=void 0),this.hoveringSlot=t,this.isHovering=!!t,i&&(i.isDragHovering=!1,i.indexToDrop=void 0,i.info.onDragHoverStatusChange==null||i.info.onDragHoverStatusChange(this.ctx)),t&&(t.isDragHovering=!0,t.indexToDrop=e,t.info.onDragHoverStatusChange==null||t.info.onDragHoverStatusChange(this.ctx)),this.emit("hoverChanged",this.ctx)}getDefaultBlockEventHandlers(t,e){return V({dragStart:this.handleBlockDragStart.bind(this,t),dragEnd:this.handleBlockDragEnd.bind(this,t),dragOver:this.handleBlockDragOver.bind(this,t),dragLeave:this.handleBlockDragLeave.bind(this,t)},e)}handleBlockDragStart(t,e){const o=e.dataTransfer;if(!o)return;this.ctx.activeBlocks.has(t)||this.ctx.addBlockToSelection(t,"none");const i=this.ctx.getTextForClipboard();if(!i)return;const s=Array.from(this.ctx.activeBlocks),n=new dt({type:"blockDragStart",text:i,blocks:s,ctx:this.ctx,currentBlock:t,dataTransfer:o,event:e});if(t.info.onDragStart==null||t.info.onDragStart(n),this.emit("blockDragStart",n),n.returnValue===!1)return;e.stopPropagation(),o.setData("text/plain",n.text),o.setData("x-block-context/uuid",this.ctx.uuid),s.length>1&&(document.body.appendChild(p),p.style.left=`${e.clientX}px`,p.style.top=`${e.clientY}px`,setTimeout(()=>p.remove(),100),p.textContent=`${s.length} items`,o.setDragImage(p,p.offsetWidth/2,p.offsetHeight/2));const c=this.ctx.slotOfActiveBlocks;this.draggingBlocks=s,this.slotOfDraggingBlocks=c||void 0,c&&(this.setHoveringSlot(c,t.index),this.setHoveringSlot.flush())}handleBlockDragEnd(t,e){this.slotOfDraggingBlocks=void 0,this.draggingBlocks=void 0,this.setHoveringSlot(void 0)}handleBlockDragOver(t){this.hoveringBlock!==t&&t.ownerSlot==this.hoveringSlot&&(this.hoveringBlock=t,this.emit("hoverChanged",this.ctx))}handleBlockDragLeave(t){this.hoveringBlock===t&&(this.hoveringBlock=void 0,this.emit("hoverChanged",this.ctx))}getDefaultSlotEventHandlers(t,e){return V({dragOver:o=>{this.handleSlotDragOver(t,o)&&(o.preventDefault(),o.stopPropagation())},dragLeave:o=>{this.handleSlotDragLeave(t),o.preventDefault(),o.stopPropagation()},drop:o=>{this.handleSlotDrop(t,o),o.preventDefault(),o.stopPropagation()}},e)}handleSlotDragOver(t,e){const o=this.computeIndexToDrop(t,e);return o!==!1&&(this.setHoveringSlot(t,o),!0)}handleSlotDrop(t,e){const o=this.computeIndexToDrop(t,e);if(o===!1)return;const i=this.dropEffect,s=this.draggingBlocks,n=this.ctx,c=new ut({type:"slotBeforeDrop",ctx:n,slot:t,dropEffect:i,dataTransfer:e.dataTransfer,event:e,indexToDrop:o,isDraggingFromCurrentCtx:!!s,draggingBlocks:s});if(this.emit("slotBeforeDrop",c),c.returnValue===!1)return this.setHoveringSlot(void 0),void this.setHoveringSlot.flush();if(this.setHoveringSlot(t,o),this.setHoveringSlot.flush(),s&&i!=="copy")if(t===n.slotOfActiveBlocks){const r=o-s.filter(v=>v.index<o).length,h=new at({type:"moveInSlot",blocks:s,ctx:n,slot:t,index:r});if(t.info.onMoveInSlot==null||t.info.onMoveInSlot(h),n.emit("moveInSlot",h),!h.returnValue)return;setTimeout(()=>{n.activeSlot=t,n.activeBlocks.clear(),t.items.forEach(v=>{const u=v.index;u>=r&&u<r+s.length&&n.activeBlocks.add(v)}),n.syncActiveElementStatus(),n.focus()},100)}else{const r=o,h=new ht({type:"moveBetweenSlots",blocks:s,ctx:n,fromSlot:n.slotOfActiveBlocks,toSlot:t,index:r});if(t.info.onMoveToThisSlot==null||t.info.onMoveToThisSlot(h),n.emit("moveBetweenSlots",h),!h.returnValue)return;setTimeout(()=>{n.activeSlot=t,n.activeBlocks.clear(),t.items.forEach(v=>{const u=v.index;u>=r&&u<r+s.length&&n.activeBlocks.add(v)}),n.syncActiveElementStatus(),n.focus()},100)}else try{const r=JSON.parse(e.dataTransfer.getData("text/plain"));n.activeSlot=t,n.activeBlocks.clear(),n.syncActiveElementStatus(),n.pasteWithData(r,o),n.focus()}catch(r){console.error("Failed to drop")}this.setHoveringSlot(void 0)}handleSlotDragLeave(t){this.setHoveringSlot(void 0)}computeIndexToDrop(t,e){var o;let i=e.dataTransfer.dropEffect;if(i==="none"&&kt&&(i=e.ctrlKey||e.altKey?"copy":"move"),this.dropEffect=i,this.dropEffect!=="copy"&&(o=this.draggingBlocks)!=null&&o.some(r=>t.isDescendantOfBlock(r)))return!1;const s=t.info.computeIndexToDrop==null?void 0:t.info.computeIndexToDrop({ctx:this.ctx,slot:t,isDraggingFromCurrentCtx:!!this.draggingBlocks,draggingBlocks:this.draggingBlocks,dataTransfer:e.dataTransfer,dropEffect:this.dropEffect,currentTarget:e.currentTarget,clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY});return s!==!1&&(s===void 0?(n=(c=this.hoveringBlock)==null?void 0:c.index)!=null?n:function(r,h,v){if(!r)return 0;let u=0;for(const d of r)u=Math.max(u,d.index+1);return u}(t.items):s);var n,c}}class Bt{constructor(t,e,o){this.type="slot",this.ctx=void 0,this.ownerBlock=void 0,this.items=new Set,this.info=void 0,this.handlePointerUp=()=>this.ctx.handleSlotPointerUp(this),this.handlePointerUpCapture=()=>this.ctx.handleSlotPointerUp(this,!0),this._isActive=!1,this.ctx=t,this.ownerBlock=e,e&&e.slots.add(this),this.info=o}createBlock(t){return this.ctx.createBlock(t,this)}get ref(){return this.info.ref}get isActive(){return this._isActive}setActive(t){var e,o;return this._isActive!==t&&(this._isActive=t,(e=(o=this.info).onActiveStatusChange)==null||e.call(o,this),!0)}isDescendantOfBlock(t){let e=this.ownerBlock;for(;e;){var o;if(e===t)return!0;e=(o=e.ownerSlot)==null?void 0:o.ownerBlock}return!1}isDescendantOfSlot(t){var e;let o=(e=this.ownerBlock)==null?void 0:e.ownerSlot;for(;o;){var i;if(o===t)return!0;o=(i=o.ownerBlock)==null?void 0:i.ownerSlot}return!1}dispose(){var t;let e=!1;this.ctx.slotOfActiveBlocks===this&&(this.ctx.activeBlocks.clear(),e=!0),this.ctx.activeSlot===this&&(this.ctx.activeSlot=null,e=!0),e&&this.ctx.syncActiveElementStatus(),(t=this.ownerBlock)==null||t.slots.delete(this),this.items.forEach(o=>o.dispose()),this.items.clear(),this.info={}}}const xt={deactivateHandlersWhenBlur:!0,navigateWithArrowKeys:!0,handleDeleteKey:!0,multipleSelect:!0};class yt extends ${constructor(t={}){super(),this.hiddenInput=void 0,this._lastActiveElement=null,this.hasFocus=!1,this.options=void 0,this.uuid=`${Date.now().toString(36)}-${Math.random().toString(36)}`,this.dragging=new St(this),this.activeBlocks=new Set,this.slotOfActiveBlocks=null,this.activeSlot=null,this.lastActiveSlot=null,this.lastActiveBlocks=void 0,this.isFocusingBlock=void 0,this.isFocusingSlot=void 0,this.handleSlotPointerUp=(i,s)=>{!s&&this.isFocusingSlot||(this.isFocusingSlot=i)},this.handleBlockPointerUp=(i,s)=>{!s&&this.isFocusingBlock||(this.isFocusingBlock=i)},this.handleGlobalPointerUp=i=>{const s=this.isFocusingBlock,n=this.isFocusingSlot;this.isFocusingBlock=void 0,this.isFocusingSlot=void 0,s?(this.activeSlot=n||null,this.addBlockToSelection(s,i.ctrlKey||i.metaKey?"ctrl":i.shiftKey?"shift":"none")):this.options.deactivateHandlersWhenBlur&&this.activeBlocks.size>0&&this.activeBlocks.clear(),this.syncActiveElementStatus()},this.options=H({},xt,t),document.addEventListener("pointerup",this.handleGlobalPointerUp,!1);const e=this.hiddenInput=document.createElement("textarea");e.style.cssText="opacity:0;left:0;top:0;position:fixed;width:2px;height:2px",e.tabIndex=-1,e.inputMode="none",e.ownerDocument.body.appendChild(e);const o=i=>{var s;const n=this.getTextForClipboard();n&&(i.preventDefault(),(s=i.clipboardData)==null||s.setData("text/plain",n))};e.addEventListener("copy",i=>{o(i)},!1),e.addEventListener("cut",i=>{o(i),this.deleteActiveBlocks()},!1),e.addEventListener("paste",i=>{i.preventDefault();try{var s;const n=(s=i.clipboardData)==null?void 0:s.getData("text/plain");if(!n)return;const c=JSON.parse(n);this.pasteWithData(c)}catch(n){console.error("Failed to paste!",n)}},!1),e.addEventListener("focus",()=>{this.hasFocus=!0,this.emit("focus",this)},!1),e.addEventListener("blur",()=>{this.hasFocus=!1,this._lastActiveElement=null,this.emit("blur",this)},!1),e.addEventListener("keydown",i=>{const s=this.options;switch(i.code){case"KeyA":var n;s.multipleSelect&&(i.ctrlKey||i.metaKey)&&(this.activeBlocks.clear(),Array.from(((n=this.slotOfActiveBlocks)==null?void 0:n.items)||[]).sort((c,r)=>c.index-r.index).forEach(c=>this.activeBlocks.add(c)),this.syncActiveElementStatus());break;case"ArrowUp":s.navigateWithArrowKeys&&this.activeNextBlock(-1,i.shiftKey||i.ctrlKey||i.metaKey);break;case"ArrowDown":s.navigateWithArrowKeys&&this.activeNextBlock(1,i.shiftKey||i.ctrlKey||i.metaKey);break;case"ArrowLeft":s.navigateWithArrowKeys&&this.activeParentBlock();break;case"ArrowRight":s.navigateWithArrowKeys&&this.activeChildrenBlocks();break;case"Delete":case"Backspace":s.handleDeleteKey&&this.deleteActiveBlocks();break;case"Tab":{const c=this._lastActiveElement;if(c&&"focus"in c){const r=c.tabIndex===-1&&c.querySelector("[tabIndex], button, textarea, input, select, a, [contentEditable]");r&&"focus"in r?r.focus():c.focus()}i.preventDefault()}}},!1)}focus(){document.activeElement!==this.hiddenInput&&(this._lastActiveElement=document.activeElement,this.hiddenInput.focus())}getTextForClipboard(){const t={isIBClipboardData:!0,ibContextUUID:this.uuid,blocksData:[]};if(this.activeBlocks.forEach(e=>{t.blocksData.push(e.data)}),t.blocksData.length!==0)return JSON.stringify(t)}copy(){this.hiddenInput.focus(),document.execCommand("copy")}pasteWithData(t,e){if(!lt(t))throw new Error("Invalid IBClipboardData");const o=this.activeSlot;if(!o)return;const i=w(this.activeBlocks),s=e!=null?e:o===(i==null?void 0:i.ownerSlot)?i.index:Math.max(0,...Array.from(o.items.values(),c=>1+c.index)),n=new rt({type:"paste",ctx:this,data:t,slot:o,index:s});o.info.onPaste==null||o.info.onPaste(n),this.emit("paste",n),n.returnValue!==!1&&setTimeout(()=>{const c=t.blocksData.length+s-1,r=Array.from(o.items).filter(h=>h.index>=s&&h.index<=c);r.length&&(this.activeSlot=o,this.activeBlocks.clear(),r.forEach(h=>this.activeBlocks.add(h)),this.syncActiveElementStatus())},100)}deleteActiveBlocks(){var t;const e=Array.from(this.activeBlocks.values()),o=(t=e[0])==null?void 0:t.ownerSlot;if(!o)return!1;const i=e[0].index,s=new ct({type:"cut",blocks:e,ctx:this,slot:o});if(o.info.onCut==null||o.info.onCut(s),this.emit("cut",s),s.returnValue){const n=W(o.items,c=>c.index===i);n&&this.addBlockToSelection(n)}return s.returnValue}activeNextBlock(t,e=!1){const o=e&&this.options.multipleSelect;this.focus();let i=!0,s=Array.from(this.activeBlocks);var n;if(!s.length&&(s=Array.from(((n=this.activeSlot)==null?void 0:n.items)||[]),i=!1,!s.length))return;const c=s[0].ownerSlot;let r=s[0].index,h=r,v=s[0],u=v;s.slice(1).forEach(f=>{if(f.ownerSlot!==c)return;const m=f.index;m>r&&(r=m,v=f),m<h&&(h=m,u=f)});const d=t>0?r+t:h+t,g=W(c==null?void 0:c.items,f=>f.index===d);g?(o||this.activeBlocks.clear(),this.activeBlocks.add(g),this.activeSlot=c,this.syncActiveElementStatus()):i?o||(this.activeBlocks.clear(),s.length>1&&this.activeBlocks.add(t>0?v:u),this.syncActiveElementStatus()):(this.activeBlocks.clear(),o?s.forEach(f=>this.activeBlocks.add(f)):this.activeBlocks.add(t>0?u:v),this.syncActiveElementStatus())}activeParentBlock(){var t;const e=(t=this.activeSlot)==null?void 0:t.ownerBlock;this.activeSlot=(e==null?void 0:e.ownerSlot)||null,this.activeBlocks.clear(),e&&this.activeBlocks.add(e),this.syncActiveElementStatus()}activeChildrenBlocks(){const t=w(this.activeBlocks),e=w(t==null?void 0:t.slots);if(e){if(this.activeSlot=e,this.activeBlocks.clear(),this.options.multipleSelect)e.items.forEach(o=>this.activeBlocks.add(o));else{const o=w(e.items);o&&this.activeBlocks.add(o)}this.syncActiveElementStatus()}}syncActiveElementStatus(){var t;let e=!1;const o=this.lastActiveBlocks,i=this.lastActiveSlot,s=Array.from(this.activeBlocks),n=((t=s[0])==null?void 0:t.ownerSlot)||null;var c;s.length>1&&n!==this.activeSlot&&(this.activeSlot=n),!this.activeSlot&&n&&(this.activeSlot=n),s.forEach((r,h)=>{o==null||o.delete(r),e=r.setSelectStatus(h)||e}),o==null||o.forEach(r=>{e=r.setSelectStatus(!1)||e}),this.activeSlot!==i&&(i==null||i.setActive(!1),(c=this.activeSlot)==null||c.setActive(!0),this.lastActiveSlot=this.activeSlot,e=!0),this.lastActiveBlocks=new Set(this.activeBlocks),this.slotOfActiveBlocks=n,e&&this.emit("activeElementChanged",this)}clearSelection(){this.activeBlocks.clear(),this.activeSlot=null,this.syncActiveElementStatus()}addBlockToSelection(t,e="none"){if(typeof e=="object"&&(e=e.ctrlKey||e.metaKey?"ctrl":e.shiftKey?"shift":"none"),this.options.multipleSelect||(e="none"),e==="ctrl")t.ownerSlot!==this.slotOfActiveBlocks&&this.activeBlocks.clear(),this.activeBlocks.add(t),this.activeSlot=t.ownerSlot||null;else if(e==="shift"){const o=t.ownerSlot;o!==this.slotOfActiveBlocks&&this.activeBlocks.clear();const i=t.index;let s=i,n=i;this.activeBlocks.forEach(c=>{const r=c.index;s>r&&(s=r),n<r&&(n=r)}),o?(this.activeBlocks.clear(),o.items.forEach(c=>{const r=c.index;r>=s&&r<=n&&this.activeBlocks.add(c)}),this.activeSlot=o):(this.activeBlocks.add(t),this.activeSlot=null)}else this.activeBlocks.clear(),this.activeBlocks.add(t);this.syncActiveElementStatus()}dispose(){var t;this.dragging.dispose(),(t=this.hiddenInput.parentElement)==null||t.removeChild(this.hiddenInput),document.removeEventListener("pointerup",this.handleGlobalPointerUp,!1)}createBlock(t,e=null){return new vt(this,e,t)}createSlot(t,e=null){return new Bt(this,e,t)}}const bt=()=>[{name:"aaa"},{name:"bbb",children:[{name:"b1"},{name:"b2"}]},{name:"ccc"}],wt=l=>{const t=[...l],e={};return{root:t,copiedBlocks:e,getSlotAndBlock(o){let i=t,s=null,n="";return o.forEach(c=>{if(n+=`/${c}`,!(n in e)){const r=i[c],h=F(k({},r),{children:[...r.children||[]]});i[c]=h,e[n]=h}s=e[n],i=s.children}),{slot:i,block:s}}}},Dt=(l,t)=>{if("__demo_wholeReplace__"in t)return t.__demo_wholeReplace__;const e=wt(l),{slot:o,block:i}=e.getSlotAndBlock(t.path);if(t.rename&&i&&(i.name=t.rename.name),t.insert&&o.splice(t.insert.index,0,...t.insert.items),t.remove&&P(o,t.remove.indexes),t.moveInSlot){const{fromIndexes:s,toIndex:n}=t.moveInSlot;pt(o,s,n)}if(t.moveBetweenSlots){const{fromPath:s,fromIndexes:n,toIndex:c}=t.moveBetweenSlots,r=e.getSlotAndBlock(s).slot;mt(r,n,o,c)}return console.log("store reducer called",t,e),e.root},j=C(null),At=l=>{const t=U(Dt,null,bt);return a(j.Provider,{value:t},l.children)},D=()=>T(j),R=C(null),J=()=>T(R),Et=R.Provider,A=C(null);A.displayName="OwnerSlot";const Ct=()=>T(A),Tt=A.Provider;A.Consumer;const O=l=>{const t=b(l);t.current=l,I(()=>()=>t.current(),[])},X=()=>{const[,l]=U(t=>(t+1)%16777215,0);return l},It=l=>k({},l),Ht=l=>k({},l),x=l=>{const t=[];for(;l;)t.unshift(l.index),l=l.ownerSlot.ownerBlock;return t},E=(...l)=>l.filter(t=>!!t).map(t=>Array.isArray(t)?E(t):String(t)).join(" "),G=K(function(t){var u;const e=t.ownerBlock||null,[,o]=D(),i=X(),s=J(),n=y(()=>s.createSlot({onCut:d=>o({path:x(e),remove:{indexes:d.blocks.map(g=>g.index)}}),onPaste:d=>o({path:x(e),insert:{index:d.index,items:d.data.blocksData.map(It)}}),onActiveStatusChange:()=>i(),onDragHoverStatusChange:()=>i(),onMoveInSlot:d=>o({path:x(e),moveInSlot:{fromIndexes:d.blocks.map(g=>g.index),toIndex:d.index}}),onMoveToThisSlot:d=>{var g;return o({path:x(e),moveBetweenSlots:{fromPath:x((g=d.fromSlot)==null?void 0:g.ownerBlock),fromIndexes:d.blocks.map(f=>f.index),toIndex:d.index}})}},e),[]);O(()=>n.dispose());const c=S(d=>{n.handlePointerUp(),document.activeElement===d.currentTarget&&n.ctx.focus()},[]),r=y(()=>s.dragging.getDefaultSlotEventHandlers(n,"react"),[]),{isActive:h,isDragHovering:v}=n;return a("div",k({className:E("mySlot",h&&"isActive",v&&"isDragHovering"),tabIndex:-1,onPointerUp:c},r),a(Tt,{value:n},((u=t.children)==null?void 0:u.length)>0?t.children:a("div",{className:"mySlot-emptyPlaceholder"},"Nothing")),n.isDragHovering&&a("div",{className:"mySlot-indexToDrop",key:"indexToDrop",style:{"grid-row-start":n.indexToDrop+1}},`indexToDrop = ${n.indexToDrop}`))}),Pt=K(function l(t){var g;const{index:e,item:o}=t,i=X(),s=b();et(s,()=>({index:e,item:o}),[e,o]);const n=J(),c=Ct(),r=y(()=>n.createBlock({data:()=>Ht(s.current.item),index:()=>s.current.index,onActiveStatusChange:()=>i()},c),[]);O(()=>r.dispose());const h=S(f=>{r.handlePointerUp(),document.activeElement===f.currentTarget&&r.ctx.focus()},[]),v=y(()=>n.dragging.getDefaultBlockEventHandlers(r,"react"),[]),{activeNumber:u,isActive:d}=r;return a("div",k({className:E("myBlock",d&&"isActive"),tabIndex:-1,onPointerUp:h,draggable:!0},v),d&&a("div",{className:"myBlock-selectIndex"},u+1),a(Ot,{name:o.name,blockHandler:r}),a(G,{ownerBlock:r},((g=o.children)==null?void 0:g.length)?o.children.map((f,m)=>a(l,{key:m,index:m,item:f})):null))}),Ot=l=>{const[,t]=D(),e=S(o=>{const i=l.blockHandler,s=x(i),n=o.currentTarget.value;t({path:s,rename:{name:n}})},[]);return a("input",{className:"blockNameInput",type:"text",value:l.name,onChange:e})},_t=()=>{const[l,t]=D(),e=b(null);I(()=>{e.current.value=JSON.stringify(l,null,2)},[l]);const o=b(null);o.current=l;const i=S((c=!0)=>{try{const r=JSON.parse(e.current.value);t({path:[],__demo_wholeReplace__:r})}catch(r){c&&(e.current.value=JSON.stringify(o.current,null,2)),console.error("Failed to replace: ",r)}},[]),s=S(()=>i(!0),[]),n=S(()=>i(!1),[]);return a("div",null,a("ul",null,a("li",null,"Click to select block / slot"),a("li",null,"Drag and drop. Also supports cross-window dragging."),a("li",null,"Copy, Cut, Paste with ",a("kbd",null,"Ctrl+C")," / ",a("kbd",null,"Ctrl+X")," / ",a("kbd",null,"Ctrl+V")),a("li",null,"Navigate between blocks with arrow keys"),a("li",null,"Select multiple blocks with ",a("kbd",null,"Ctrl")," or ",a("kbd",null,"Shift"))),a("h3",null,"Current Store"),a("textarea",{class:"demoPage-store",spellcheck:!1,ref:e,onBlur:s,onInput:n}))},Nt=function(){const[l]=D(),[t,e]=ot(!1),o=y(()=>new yt,[]);return O(()=>o.dispose()),I(()=>{o.on("focus",()=>e(!0)),o.on("blur",()=>e(!1)),o.on("paste",i=>{console.log("pasting...",i)})},[]),a(Et,{value:o},Ft,a("div",{className:E("demoPage",t&&"hasFocus")},a("div",{className:"demoPage-blockArea"},a(G,null,l.map((i,s)=>a(Pt,{key:s,index:s,item:i})))),a("div",{className:"demoPage-introductionArea"},a(_t,null))))},Y="https://github.com/lyonbot/interactive-blocks#readme",Ft=a(it,null,a("h2",null,"InteractiveBlocks"),a("p",null,"Just proving the abilities with shabby Slot and Block components here."),a("p",null,"Learn how to integrate with your own components? ",a("a",{href:Y,target:"_blank"},"Read the guide on GitHub")),a("a",{className:"demoPage-forkMe",href:Y,target:"_blank"},"Fork me on GitHub"));st(a(At,null,a(Nt,null)),document.getElementById("app"));
