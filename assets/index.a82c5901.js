var J=Object.defineProperty,$=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var I=(n,t,e)=>t in n?J(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,S=(n,t)=>{for(var e in t||(t={}))V.call(t,e)&&I(n,e,t[e]);if(U)for(var e of U(t))q.call(t,e)&&I(n,e,t[e]);return n},F=(n,t)=>$(n,G(t));import{D as w,F as A,p as O,v as a,T as z,s as y,y as E,g as K,d as C,A as k,_ as X,l as Q,a as Y,S as Z}from"./vendor.0ccd728c.js";const tt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}};tt();const et=()=>[{name:"aaa"},{name:"bbb",children:[{name:"b1"},{name:"b2"}]},{name:"ccc"}],st=(n,t)=>{if("__demo_wholeReplace__"in t)return t.__demo_wholeReplace__;const e=[...n];let o=e,i=null;return t.path.forEach(s=>{const l=o[s],r=F(S({},l),{children:[...l.children||[]]});o[s]=r,i=r,o=r.children}),t.rename&&i&&(i.name=t.rename.name),t.insert&&o.splice(t.insert.index,0,...t.insert.items),t.remove&&[...t.remove.indexes].sort((s,l)=>l-s).forEach(s=>o.splice(s,1)),console.log("store reducer called",t,e),e},L=w(null),it=n=>{const t=O(st,null,et);return a(L.Provider,{value:t},n.children)},B=()=>A(L);function P(){return P=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},P.apply(this,arguments)}const M=(n,t)=>typeof n=="function"?n(t):n;class ot{get activeNumber(){return this._activeNumber}get isActive(){return this._activeNumber!==!1}setSelectStatus(t){var e,o;return this._activeNumber!==t&&(this._activeNumber=t,(e=(o=this.info).onActiveStatusChange)==null||e.call(o,this),!0)}constructor(t,e,o){this.type="block",this.ctx=void 0,this.ownerSlot=void 0,this.slots=new Set,this.info=void 0,this._activeNumber=!1,this.handlePointerUp=()=>this.ctx.handleBlockPointerUp(this,!1),this.handlePointerUpCapture=()=>this.ctx.handleBlockPointerUp(this,!0),this.ctx=t,this.ownerSlot=e,e&&e.items.add(this),this.info=o}get index(){return M(this.info.index,this)}get data(){return M(this.info.data,this)}createSlot(t){return this.ctx.createSlot(t,this)}dispose(){var t;this.ctx.activeBlocks.has(this)&&(this.ctx.activeBlocks.delete(this),this.ctx.syncActiveElementStatus()),(t=this.ownerSlot)==null||t.items.delete(this),this.slots.forEach(e=>e.dispose()),this.slots.clear()}}function b(n){if(n)return n[Symbol.iterator]().next().value}class nt{constructor(t,e,o){this.type="slot",this.ctx=void 0,this.ownerBlock=void 0,this.items=new Set,this.info=void 0,this.handlePointerUp=()=>this.ctx.handleSlotPointerUp(this),this.handlePointerUpCapture=()=>this.ctx.handleSlotPointerUp(this,!0),this._isActive=!1,this.ctx=t,this.ownerBlock=e,e&&e.slots.add(this),this.info=o}createBlock(t){return this.ctx.createBlock(t,this)}get isActive(){return this._isActive}setActive(t){var e,o;return this._isActive!==t&&(this._isActive=t,(e=(o=this.info).onActiveStatusChange)==null||e.call(o,this),!0)}dispose(){var t;let e=!1;this.ctx.slotOfActiveBlocks===this&&(this.ctx.activeBlocks.clear(),e=!0),this.ctx.activeSlot===this&&(this.ctx.activeSlot=null,e=!0),e&&this.ctx.syncActiveElementStatus(),(t=this.ownerBlock)==null||t.slots.delete(this),this.items.forEach(o=>o.dispose()),this.items.clear()}}const lt={deactivateHandlersWhenBlur:!0,navigateWithArrowKeys:!0,handleDeleteKey:!0,multipleSelect:!0};class ct extends z{constructor(t={}){super(),this.hiddenInput=void 0,this._lastActiveElement=null,this.hasFocus=!1,this.options=void 0,this.uuid=`${Date.now().toString(36)}-${Math.random().toString(36)}`,this.activeBlocks=new Set,this.slotOfActiveBlocks=null,this.activeSlot=null,this.lastActiveSlot=null,this.lastActiveBlocks=void 0,this.isFocusingBlock=void 0,this.isFocusingSlot=void 0,this.handleSlotPointerUp=(i,s)=>{!s&&this.isFocusingSlot||(this.isFocusingSlot=i)},this.handleBlockPointerUp=(i,s)=>{!s&&this.isFocusingBlock||(this.isFocusingBlock=i)},this.handleGlobalPointerUp=i=>{const s=this.isFocusingBlock,l=this.options.multipleSelect;let r=this.isFocusingSlot;if(this.isFocusingBlock=void 0,this.isFocusingSlot=void 0,s)if(l&&(i.ctrlKey||i.metaKey))s.ownerSlot!==this.slotOfActiveBlocks&&this.activeBlocks.clear(),this.activeBlocks.add(s),r=s.ownerSlot||void 0;else if(l&&i.shiftKey){const c=s.ownerSlot;c!==this.slotOfActiveBlocks&&this.activeBlocks.clear();const v=s.index;let u=v,m=v;this.activeBlocks.forEach(p=>{const h=p.index;u>h&&(u=h),m<h&&(m=h)}),c?(this.activeBlocks.clear(),c.items.forEach(p=>{const h=p.index;h>=u&&h<=m&&this.activeBlocks.add(p)})):this.activeBlocks.add(s)}else this.activeBlocks.clear(),this.activeBlocks.add(s);else this.options.deactivateHandlersWhenBlur&&this.activeBlocks.size>0&&this.activeBlocks.clear();this.activeSlot=r||null,this.syncActiveElementStatus()},this.options=P({},lt,t),document.addEventListener("pointerup",this.handleGlobalPointerUp,!1);const e=this.hiddenInput=document.createElement("textarea");e.style.cssText="opacity:0;left:0;top:0;position:fixed;width:2px;height:2px",e.tabIndex=-1,e.inputMode="none",e.ownerDocument.body.appendChild(e);const o=i=>{var s;const l={isCBClipboardData:!0,cbContextUUID:this.uuid,blocksData:[]};this.activeBlocks.forEach(r=>{l.blocksData.push(r.data)}),l.blocksData.length!==0&&(i.preventDefault(),(s=i.clipboardData)==null||s.setData("text/plain",JSON.stringify(l)))};e.addEventListener("copy",i=>{o(i)},!1),e.addEventListener("cut",i=>{o(i),this.deleteActiveBlocks()},!1),e.addEventListener("paste",i=>{i.preventDefault();try{var s;const l=(s=i.clipboardData)==null?void 0:s.getData("text/plain");if(!l)return;const r=JSON.parse(l);if(!function(h){return!(typeof h!="object"||!h||h.isCBClipboardData!==!0||"cbContextUUID"in h&&typeof h.cbContextUUID!="string"||!Array.isArray(h.blocksData)||h.blocksData.some(d=>typeof d!="object"||d===null))}(r))throw new Error("Invalid CBClipboardData");const c=this.activeSlot;if(!c)return;const v=b(this.activeBlocks),u=c===(v==null?void 0:v.ownerSlot)?v.index:Math.max(0,...Array.from(c.items.values(),h=>1+h.index)),m={type:"beforePaste",ctx:this,data:r,slot:c,preventDefault(){m.returnValue=!1},returnValue:!0};if(c.info.onBeforePaste==null||c.info.onBeforePaste(m),this.emit("beforePaste",m),m.returnValue===!1)return;const p={type:"paste",ctx:this,data:r,slot:c,index:u};c.info.onPaste==null||c.info.onPaste(p),this.emit("paste",p),setTimeout(()=>{const h=r.blocksData.length+u-1,d=Array.from(c.items).filter(f=>f.index>=u&&f.index<=h);d.length&&(this.activeSlot=c,this.activeBlocks.clear(),d.forEach(f=>this.activeBlocks.add(f)),this.syncActiveElementStatus())},100)}catch(l){console.error("Failed to paste!",l)}},!1),e.addEventListener("focus",()=>{this.hasFocus=!0,this.emit("focus",this)},!1),e.addEventListener("blur",()=>{this.hasFocus=!1,this._lastActiveElement=null,this.emit("blur",this)},!1),e.addEventListener("keydown",i=>{const s=this.options;switch(i.code){case"ArrowUp":s.navigateWithArrowKeys&&this.activeNextBlock(-1,i.shiftKey||i.ctrlKey||i.metaKey);break;case"ArrowDown":s.navigateWithArrowKeys&&this.activeNextBlock(1,i.shiftKey||i.ctrlKey||i.metaKey);break;case"ArrowLeft":s.navigateWithArrowKeys&&this.activeParentBlock();break;case"ArrowRight":s.navigateWithArrowKeys&&this.activeChildrenBlocks();break;case"Delete":case"Backspace":s.handleDeleteKey&&this.deleteActiveBlocks();break;case"Tab":{const l=this._lastActiveElement;if(l&&"focus"in l){const r=l.tabIndex===-1&&l.querySelector("[tabIndex], button, textarea, input, select, a, [contentEditable]");r&&"focus"in r?r.focus():l.focus()}i.preventDefault()}}},!1)}focus(){document.activeElement!==this.hiddenInput&&(this._lastActiveElement=document.activeElement,this.hiddenInput.focus())}copy(){this.hiddenInput.focus(),document.execCommand("copy")}deleteActiveBlocks(){var t;const e=Array.from(this.activeBlocks.values()),o=(t=e[0])==null?void 0:t.ownerSlot;if(!o)return;const i={type:"cut",blocks:e,ctx:this,slot:o};o.info.onCut==null||o.info.onCut(i),this.emit("cut",i)}activeNextBlock(t,e=!1){const o=e&&this.options.multipleSelect;this.focus();let i=!0,s=Array.from(this.activeBlocks);var l;if(!s.length&&(s=Array.from(((l=this.activeSlot)==null?void 0:l.items)||[]),i=!1,!s.length))return;const r=s[0].ownerSlot;let c=s[0].index,v=c,u=s[0],m=u;s.slice(1).forEach(d=>{if(d.ownerSlot!==r)return;const f=d.index;f>c&&(c=f,u=d),f<v&&(v=f,m=d)});const p=t>0?c+t:v+t,h=function(d,f){if(!!d){for(const _ of d)if(f(_))return _}}(r==null?void 0:r.items,d=>d.index===p);h?(o||this.activeBlocks.clear(),this.activeBlocks.add(h),this.activeSlot=r,this.syncActiveElementStatus()):i?o||(this.activeBlocks.clear(),s.length>1&&this.activeBlocks.add(t>0?u:m),this.syncActiveElementStatus()):(this.activeBlocks.clear(),o?s.forEach(d=>this.activeBlocks.add(d)):this.activeBlocks.add(t>0?m:u),this.syncActiveElementStatus())}activeParentBlock(){var t;const e=(t=this.activeSlot)==null?void 0:t.ownerBlock;this.activeSlot=(e==null?void 0:e.ownerSlot)||null,this.activeBlocks.clear(),e&&this.activeBlocks.add(e),this.syncActiveElementStatus()}activeChildrenBlocks(){const t=b(this.activeBlocks),e=b(t==null?void 0:t.slots);if(e){if(this.activeSlot=e,this.activeBlocks.clear(),this.options.multipleSelect)e.items.forEach(o=>this.activeBlocks.add(o));else{const o=b(e.items);o&&this.activeBlocks.add(o)}this.syncActiveElementStatus()}}syncActiveElementStatus(){var t;let e=!1;const o=this.lastActiveBlocks,i=this.lastActiveSlot,s=Array.from(this.activeBlocks),l=((t=s[0])==null?void 0:t.ownerSlot)||null;var r;s.length>1&&l!==this.activeSlot&&(this.activeSlot=l),!this.activeSlot&&l&&(this.activeSlot=l),s.forEach((c,v)=>{o==null||o.delete(c),e=c.setSelectStatus(v)||e}),o==null||o.forEach(c=>{e=c.setSelectStatus(!1)||e}),this.activeSlot!==i&&(i==null||i.setActive(!1),(r=this.activeSlot)==null||r.setActive(!0),this.lastActiveSlot=this.activeSlot,e=!0),this.lastActiveBlocks=new Set(this.activeBlocks),this.slotOfActiveBlocks=l,e&&this.emit("activeElementChanged",this)}dispose(){var t;(t=this.hiddenInput.parentElement)==null||t.removeChild(this.hiddenInput),document.removeEventListener("pointerup",this.handleGlobalPointerUp,!1)}createBlock(t,e=null){return new ot(this,e,t)}createSlot(t,e=null){return new nt(this,e,t)}}const T=w(null),H=()=>A(T),at=T.Provider,g=w(null);g.displayName="OwnerSlot";const rt=()=>A(g),ht=g.Provider;g.Consumer;const D=n=>{const t=y(n);t.current=n,E(()=>()=>t.current(),[])},R=()=>{const[,n]=O(t=>(t+1)%16777215,0);return n},ut=n=>S({},n),dt=n=>S({},n),N=n=>{const t=[];for(;n;)t.unshift(n.index),n=n.ownerSlot.ownerBlock;return t},x=(...n)=>n.filter(t=>!!t).map(t=>Array.isArray(t)?x(t):String(t)).join(" "),W=K(function(t){var v;const e=t.ownerBlock||null,[,o]=B(),i=R(),s=H(),l=C(()=>s.createSlot({onCut:u=>o({path:N(e),remove:{indexes:u.blocks.map(m=>m.index)}}),onPaste:u=>o({path:N(e),insert:{index:u.index,items:u.data.blocksData.map(ut)}}),onActiveStatusChange:()=>i()},e),[]);D(()=>l.dispose());const r=k(u=>{l.handlePointerUp(),document.activeElement===u.currentTarget&&l.ctx.focus()},[]),{isActive:c}=l;return a("div",{className:x("mySlot",c&&"isActive"),tabIndex:-1,onPointerUp:r},a(ht,{value:l},((v=t.children)==null?void 0:v.length)>0?t.children:a("div",{className:"mySlot-emptyPlaceholder"},"Nothing")))}),vt=K(function n(t){var p;const{index:e,item:o}=t,i=R(),s=y();X(s,()=>({index:e,item:o}),[e,o]);const l=H(),r=rt(),c=C(()=>l.createBlock({data:()=>dt(s.current.item),index:()=>s.current.index,onActiveStatusChange:()=>i()},r),[]);D(()=>c.dispose());const v=k(h=>{c.handlePointerUp(),document.activeElement===h.currentTarget&&c.ctx.focus()},[]),{activeNumber:u,isActive:m}=c;return a("div",{className:x("myBlock",m&&"isActive"),tabIndex:-1,onPointerUp:v},m&&a("div",{className:"myBlock-selectIndex"},u+1),a(mt,{name:o.name,blockHandler:c}),a(W,{ownerBlock:c},((p=o.children)==null?void 0:p.length)?o.children.map((h,d)=>a(n,{key:d,index:d,item:h})):null))}),mt=n=>{const[,t]=B(),e=k(o=>{const i=n.blockHandler,s=N(i),l=o.currentTarget.value;t({path:s,rename:{name:l}})},[]);return a("input",{className:"blockNameInput",type:"text",value:n.name,onChange:e})},pt=()=>{const[n,t]=B(),e=y(null);E(()=>{e.current.value=JSON.stringify(n,null,2)},[n]);const o=y(null);o.current=n;const i=k((r=!0)=>{try{const c=JSON.parse(e.current.value);t({path:[],__demo_wholeReplace__:c})}catch(c){r&&(e.current.value=JSON.stringify(o.current,null,2)),console.error("Failed to replace: ",c)}},[]),s=k(()=>i(!0),[]),l=k(()=>i(!1),[]);return a("div",null,a("ul",null,a("li",null,"Click and select block / slot"),a("li",null,"Copy, Cut, Paste with ",a("kbd",null,"Ctrl+C")," / ",a("kbd",null,"Ctrl+X")," / ",a("kbd",null,"Ctrl+V")),a("li",null,"Navigate between blocks with arrow keys"),a("li",null,"Select multiple blocks with ",a("kbd",null,"Ctrl")," or ",a("kbd",null,"Shift"))),a("h3",null,"Current Store"),a("textarea",{class:"demoPage-store",spellcheck:!1,ref:e,onBlur:s,onInput:l}))},ft=function(){const[n]=B(),[t,e]=Q(!1),o=C(()=>new ct,[]);return D(()=>o.dispose()),E(()=>{o.on("focus",()=>e(!0)),o.on("blur",()=>e(!1)),o.on("paste",i=>{console.log("pasting...",i)})},[]),a(at,{value:o},kt,a("div",{className:x("demoPage",t&&"hasFocus")},a("div",{className:"demoPage-blockArea"},a(W,null,n.map((i,s)=>a(vt,{key:s,index:s,item:i})))),a("div",{className:"demoPage-introductionArea"},a(pt,null))))},j="https://github.com/lyonbot/copyable-blocks",kt=a(Y,null,a("h2",null,"CopyableBlocks"),a("p",null,"Just proving the abilities with shabby Slot and Block components here."),a("p",null,"Learn how to integrate with your own components? ",a("a",{href:j,target:"_blank"},"Read the guide on GitHub")),a("a",{className:"demoPage-forkMe",href:j,target:"_blank"},"Fork me on GitHub"));Z(a(it,null,a(ft,null)),document.getElementById("app"));
