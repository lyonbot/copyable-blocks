var G=Object.defineProperty,q=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var N=(l,t,e)=>t in l?G(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e,k=(l,t)=>{for(var e in t||(t={}))Q.call(t,e)&&N(l,e,t[e]);if(_)for(var e of _(t))Z.call(t,e)&&N(l,e,t[e]);return l},F=(l,t)=>q(l,z(t));import{D as C,T,p as U,v as a,s as w,y as I,g as L,A as y,F as S,_ as tt,l as et,d as ot,S as it}from"./vendor.444f8703.js";const nt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}};nt();function H(){return H=Object.assign||function(l){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(l[o]=e[o])}return l},H.apply(this,arguments)}const K=(l,t,e)=>{const o=l._listeners;o[t]?o[t].push(e):o[t]=[e]};class ${constructor(){this._listeners={}}on(t,e){return K(this,t,{listener:e}),this}once(t,e){return K(this,t,{listener:e,once:!0}),this}off(t,e){const o=this._listeners[t];if(!o)return this;if(o.length===1&&e===o[0].listener)return this._listeners[t]=null,this;const n=o.findIndex(i=>i.listener===e);return n!==-1&&o.splice(n,1),this}emit(t,...e){const o=this._listeners[t];if(!o)return;let n=!1;o.forEach(i=>{i.listener(e),i.once&&(n=!0)}),n&&(this._listeners[t]=o.filter(i=>!i.once))}removeAllListeners(){return this._listeners={},this}}function st(l){return!(typeof l!="object"||!l||l.isIBClipboardData!==!0||"ibContextUUID"in l&&typeof l.ibContextUUID!="string"||!Array.isArray(l.blocksData)||l.blocksData.some(t=>typeof t!="object"||t===null))}const x=()=>function(l){Object.assign(this,l),this.returnValue=!0,this.preventDefault=()=>{this.returnValue=!1}},lt=x(),rt=x(),ct=x(),at=x(),ht=x(),dt=x(),M=(l,t)=>typeof l=="function"?l(t):l;class ut{get activeNumber(){return this._activeNumber}get isActive(){return this._activeNumber!==!1}get ref(){return this.info.ref}setSelectStatus(t){var e,o;return this._activeNumber!==t&&(this._activeNumber=t,(e=(o=this.info).onActiveStatusChange)==null||e.call(o,this),!0)}constructor(t,e,o){this.type="block",this.ctx=void 0,this.ownerSlot=void 0,this.slots=new Set,this.info=void 0,this._activeNumber=!1,this.handlePointerUp=()=>this.ctx.handleBlockPointerUp(this,!1),this.handlePointerUpCapture=()=>this.ctx.handleBlockPointerUp(this,!0),this.ctx=t,this.ownerSlot=e,e&&e.items.add(this),this.info=o}get index(){return M(this.info.index,this)}get data(){return M(this.info.data,this)}createSlot(t){return this.ctx.createSlot(t,this)}dispose(){var t;this.ctx.activeBlocks.has(this)&&(this.ctx.activeBlocks.delete(this),this.ctx.syncActiveElementStatus()),(t=this.ownerSlot)==null||t.items.delete(this),this.slots.forEach(e=>e.dispose()),this.slots.clear(),this.info=vt}}const vt={index:()=>{throw new Error("Accessing a disposed block")},data:()=>{throw new Error("Accessing a disposed block")}};function ft(l,t){let e,o;function n(s=!1){e&&(s&&o&&l(...o),clearTimeout(e),e=null,o=void 0)}const i=function(...s){o=s,e||(e=setTimeout(()=>n(!0),t))};return i.cancel=()=>n(!1),i.flush=()=>n(!0),i}function P(l,t){const e=t.map(o=>l[o]).filter(o=>o!==void 0);return[...t].sort((o,n)=>n-o).forEach(o=>l.splice(o,1)),e}function gt(l,t,e){const o=P(l,t);l.splice(e,0,...o)}function pt(l,t,e,o){const n=P(l,t);e.splice(o,0,...n)}function V(l,t){if(t==="camelCase")return l;const e={};return Object.keys(l).forEach(o=>{var n;let i=o;t==="react"&&(i=`on${(n=i[0])==null?void 0:n.toUpperCase()}${i.substr(1)}`),t==="lowercase"&&(i=i.toLowerCase()),e[i]=l[o]}),e}function W(l,t){if(!l)return;let e=0;for(const o of l){if(t(o,e))return o;e+=1}}function b(l){if(l)return l[Symbol.iterator]().next().value}const mt="webkitRequestAnimationFrame"in window,p=document.createElement("div");p.style.cssText="position:fixed;pointer-events:none;left:0;top:0;background: #FFF; border: 1px solid #000; padding: 4px 8px;transform:translate(-50%, -50%)";class kt extends ${constructor(t){super(),this.ctx=void 0,this.draggingBlocks=void 0,this.slotOfDraggingBlocks=void 0,this.isHovering=!1,this.hoveringSlot=void 0,this.hoveringBlock=void 0,this.dropEffect=void 0,this.setHoveringSlot=ft(this._originalSetHoveringSlot.bind(this),50),this.ctx=t}dispose(){this.removeAllListeners(),this.setHoveringSlot.cancel()}_originalSetHoveringSlot(t,e){var o;if(t&&typeof e!="number")throw new Error("Cannot setHoveringSlot with indexToDrop unknown");if(t===this.hoveringSlot)return void(t&&t.indexToDrop!==e&&(t.indexToDrop=e,t.info.onDragHoverStatusChange==null||t.info.onDragHoverStatusChange(this.ctx),this.emit("hoverChanged",this.ctx)));const n=this.hoveringSlot;((o=this.hoveringBlock)==null?void 0:o.ownerSlot)!==t&&(this.hoveringBlock=void 0),this.hoveringSlot=t,this.isHovering=!!t,n&&(n.isDragHovering=!1,n.indexToDrop=void 0,n.info.onDragHoverStatusChange==null||n.info.onDragHoverStatusChange(this.ctx)),t&&(t.isDragHovering=!0,t.indexToDrop=e,t.info.onDragHoverStatusChange==null||t.info.onDragHoverStatusChange(this.ctx)),this.emit("hoverChanged",this.ctx)}getDefaultBlockEventHandlers(t,e){return V({dragStart:this.handleBlockDragStart.bind(this,t),dragEnd:this.handleBlockDragEnd.bind(this,t),dragOver:this.handleBlockDragOver.bind(this,t),dragLeave:this.handleBlockDragLeave.bind(this,t)},e)}handleBlockDragStart(t,e){const o=e.dataTransfer;if(!o)return;this.ctx.activeBlocks.has(t)||this.ctx.addBlockToSelection(t,"none");const n=this.ctx.getTextForClipboard();if(!n)return;const i=Array.from(this.ctx.activeBlocks),s=new ht({type:"blockDragStart",text:n,blocks:i,ctx:this.ctx,currentBlock:t,dataTransfer:o,event:e});if(t.info.onDragStart==null||t.info.onDragStart(s),this.emit("blockDragStart",s),s.returnValue===!1)return;e.stopPropagation(),o.setData("text/plain",s.text),o.setData("x-block-context/uuid",this.ctx.uuid),i.length>1&&(document.body.appendChild(p),p.style.left=`${e.clientX}px`,p.style.top=`${e.clientY}px`,setTimeout(()=>p.remove(),100),p.textContent=`${i.length} items`,o.setDragImage(p,p.offsetWidth/2,p.offsetHeight/2));const c=this.ctx.slotOfActiveBlocks;this.draggingBlocks=i,this.slotOfDraggingBlocks=c||void 0,c&&(this.setHoveringSlot(c,t.index),this.setHoveringSlot.flush())}handleBlockDragEnd(t,e){this.slotOfDraggingBlocks=void 0,this.draggingBlocks=void 0,this.setHoveringSlot(void 0)}handleBlockDragOver(t){this.hoveringBlock!==t&&t.ownerSlot==this.hoveringSlot&&(this.hoveringBlock=t,this.emit("hoverChanged",this.ctx))}handleBlockDragLeave(t){this.hoveringBlock===t&&(this.hoveringBlock=void 0,this.emit("hoverChanged",this.ctx))}getDefaultSlotEventHandlers(t,e){return V({dragOver:o=>{this.handleSlotDragOver(t,o)&&(o.preventDefault(),o.stopPropagation())},dragLeave:o=>{this.handleSlotDragLeave(t),o.preventDefault(),o.stopPropagation()},drop:o=>{this.handleSlotDrop(t,o),o.preventDefault(),o.stopPropagation()}},e)}handleSlotDragOver(t,e){const o=this.computeIndexToDrop(t,e);return o!==!1&&(this.setHoveringSlot(t,o),!0)}handleSlotDrop(t,e){const o=this.computeIndexToDrop(t,e);if(o===!1)return;const n=this.dropEffect,i=this.draggingBlocks,s=this.ctx,c=new dt({type:"slotBeforeDrop",ctx:s,slot:t,dropEffect:n,dataTransfer:e.dataTransfer,event:e,indexToDrop:o,isDraggingFromCurrentCtx:!!i,draggingBlocks:i});if(this.emit("slotBeforeDrop",c),c.returnValue===!1)return this.setHoveringSlot(void 0),void this.setHoveringSlot.flush();if(this.setHoveringSlot(t,o),this.setHoveringSlot.flush(),i&&n!=="copy")if(t===s.slotOfActiveBlocks){const r=o-i.filter(v=>v.index<o).length,h=new ct({type:"moveInSlot",blocks:i,ctx:s,slot:t,index:r});if(t.info.onMoveInSlot==null||t.info.onMoveInSlot(h),s.emit("moveInSlot",h),!h.returnValue)return;setTimeout(()=>{s.activeSlot=t,s.activeBlocks.clear(),t.items.forEach(v=>{const u=v.index;u>=r&&u<r+i.length&&s.activeBlocks.add(v)}),s.syncActiveElementStatus(),s.focus()},100)}else{const r=o,h=new at({type:"moveBetweenSlots",blocks:i,ctx:s,fromSlot:s.slotOfActiveBlocks,toSlot:t,index:r});if(t.info.onMoveToThisSlot==null||t.info.onMoveToThisSlot(h),s.emit("moveBetweenSlots",h),!h.returnValue)return;setTimeout(()=>{s.activeSlot=t,s.activeBlocks.clear(),t.items.forEach(v=>{const u=v.index;u>=r&&u<r+i.length&&s.activeBlocks.add(v)}),s.syncActiveElementStatus(),s.focus()},100)}else try{const r=JSON.parse(e.dataTransfer.getData("text/plain"));s.activeSlot=t,s.activeBlocks.clear(),s.syncActiveElementStatus(),s.pasteWithData(r,o),s.focus()}catch{console.error("Failed to drop")}this.setHoveringSlot(void 0)}handleSlotDragLeave(t){this.setHoveringSlot(void 0)}computeIndexToDrop(t,e){var o;let n=e.dataTransfer.dropEffect;if(n==="none"&&mt&&(n=e.ctrlKey||e.altKey?"copy":"move"),this.dropEffect=n,this.dropEffect!=="copy"&&(o=this.draggingBlocks)!=null&&o.some(r=>t.isDescendantOfBlock(r)))return!1;const i=t.info.computeIndexToDrop==null?void 0:t.info.computeIndexToDrop({ctx:this.ctx,slot:t,isDraggingFromCurrentCtx:!!this.draggingBlocks,draggingBlocks:this.draggingBlocks,dataTransfer:e.dataTransfer,dropEffect:this.dropEffect,currentTarget:e.currentTarget,clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY});return i!==!1&&(i===void 0?(s=(c=this.hoveringBlock)==null?void 0:c.index)!=null?s:function(r,h,v){if(!r)return 0;let u=0;for(const d of r)u=Math.max(u,d.index+1);return u}(t.items):i);var s,c}}class St{constructor(t,e,o){this.type="slot",this.ctx=void 0,this.ownerBlock=void 0,this.items=new Set,this.info=void 0,this.handlePointerUp=()=>this.ctx.handleSlotPointerUp(this),this.handlePointerUpCapture=()=>this.ctx.handleSlotPointerUp(this,!0),this._isActive=!1,this.ctx=t,this.ownerBlock=e,e&&e.slots.add(this),this.info=o}createBlock(t){return this.ctx.createBlock(t,this)}get ref(){return this.info.ref}get isActive(){return this._isActive}setActive(t){var e,o;return this._isActive!==t&&(this._isActive=t,(e=(o=this.info).onActiveStatusChange)==null||e.call(o,this),!0)}isDescendantOfBlock(t){let e=this.ownerBlock;for(;e;){var o;if(e===t)return!0;e=(o=e.ownerSlot)==null?void 0:o.ownerBlock}return!1}isDescendantOfSlot(t){var e;let o=(e=this.ownerBlock)==null?void 0:e.ownerSlot;for(;o;){var n;if(o===t)return!0;o=(n=o.ownerBlock)==null?void 0:n.ownerSlot}return!1}dispose(){var t;let e=!1;this.ctx.slotOfActiveBlocks===this&&(this.ctx.activeBlocks.clear(),e=!0),this.ctx.activeSlot===this&&(this.ctx.activeSlot=null,e=!0),e&&this.ctx.syncActiveElementStatus(),(t=this.ownerBlock)==null||t.slots.delete(this),this.items.forEach(o=>o.dispose()),this.items.clear(),this.info={}}}const xt={deactivateHandlersWhenBlur:!0,navigateWithArrowKeys:!0,handleDeleteKey:!0,multipleSelect:!0};class Bt extends ${constructor(t={}){super(),this.hiddenInput=void 0,this._lastActiveElement=null,this.hasFocus=!1,this.options=void 0,this.uuid=`${Date.now().toString(36)}-${Math.random().toString(36)}`,this.dragging=new kt(this),this.activeBlocks=new Set,this.slotOfActiveBlocks=null,this.activeSlot=null,this.lastActiveSlot=null,this.lastActiveBlocks=void 0,this.isFocusingBlock=void 0,this.isFocusingSlot=void 0,this.handleSlotPointerUp=(n,i)=>{!i&&this.isFocusingSlot||(this.isFocusingSlot=n)},this.handleBlockPointerUp=(n,i)=>{!i&&this.isFocusingBlock||(this.isFocusingBlock=n)},this.handleGlobalPointerUp=n=>{const i=this.isFocusingBlock,s=this.isFocusingSlot;this.isFocusingBlock=void 0,this.isFocusingSlot=void 0,i?(this.activeSlot=s||null,this.addBlockToSelection(i,n)):this.options.deactivateHandlersWhenBlur&&this.activeBlocks.size>0&&this.activeBlocks.clear(),this.syncActiveElementStatus()},this.options=H({},xt,t),document.addEventListener("pointerup",this.handleGlobalPointerUp,!1);const e=this.hiddenInput=document.createElement("textarea");e.style.cssText="opacity:0;left:0;top:0;position:fixed;width:2px;height:2px",e.tabIndex=-1,e.inputMode="none",e.ownerDocument.body.appendChild(e);const o=n=>{var i;const s=this.getTextForClipboard();s&&(n.preventDefault(),(i=n.clipboardData)==null||i.setData("text/plain",s))};e.addEventListener("copy",n=>{o(n)},!1),e.addEventListener("cut",n=>{o(n),this.deleteActiveBlocks()},!1),e.addEventListener("paste",n=>{n.preventDefault();try{var i;const s=(i=n.clipboardData)==null?void 0:i.getData("text/plain");if(!s)return;const c=JSON.parse(s);this.pasteWithData(c)}catch(s){console.error("Failed to paste!",s)}},!1),e.addEventListener("focus",()=>{this.hasFocus=!0,this.emit("focus",this)},!1),e.addEventListener("blur",()=>{this.hasFocus=!1,this._lastActiveElement=null,this.emit("blur",this)},!1),e.addEventListener("keydown",n=>{const i=this.options;switch(n.code){case"KeyA":var s;i.multipleSelect&&(n.ctrlKey||n.metaKey)&&(this.activeBlocks=new Set(Array.from(((s=this.slotOfActiveBlocks)==null?void 0:s.items)||[]).sort((c,r)=>c.index-r.index)),this.syncActiveElementStatus());break;case"ArrowUp":i.navigateWithArrowKeys&&this.activeNextBlock(-1,n.shiftKey||n.ctrlKey||n.metaKey);break;case"ArrowDown":i.navigateWithArrowKeys&&this.activeNextBlock(1,n.shiftKey||n.ctrlKey||n.metaKey);break;case"ArrowLeft":i.navigateWithArrowKeys&&this.activeParentBlock();break;case"ArrowRight":i.navigateWithArrowKeys&&this.activeChildrenBlocks();break;case"Delete":case"Backspace":i.handleDeleteKey&&this.deleteActiveBlocks();break;case"Tab":{const c=this._lastActiveElement;if(c&&"focus"in c){const r=c.tabIndex===-1&&c.querySelector("[tabIndex], button, textarea, input, select, a, [contentEditable]");r&&"focus"in r?r.focus():c.focus()}n.preventDefault()}}},!1)}focus(){document.activeElement!==this.hiddenInput&&(this._lastActiveElement=document.activeElement,this.hiddenInput.focus())}getTextForClipboard(){const t={isIBClipboardData:!0,ibContextUUID:this.uuid,blocksData:[]};if(this.activeBlocks.forEach(e=>{t.blocksData.push(e.data)}),t.blocksData.length!==0)return JSON.stringify(t)}copy(){this.hiddenInput.focus(),document.execCommand("copy")}pasteWithData(t,e){if(!st(t))throw new Error("Invalid IBClipboardData");const o=this.activeSlot;if(!o)return;const n=b(this.activeBlocks),i=e!=null?e:o===(n==null?void 0:n.ownerSlot)?n.index:Math.max(0,...Array.from(o.items.values(),c=>1+c.index)),s=new lt({type:"paste",ctx:this,data:t,slot:o,index:i});o.info.onPaste==null||o.info.onPaste(s),this.emit("paste",s),s.returnValue!==!1&&setTimeout(()=>{const c=t.blocksData.length+i-1,r=Array.from(o.items).filter(h=>h.index>=i&&h.index<=c);r.length&&(this.activeSlot=o,this.activeBlocks.clear(),r.forEach(h=>this.activeBlocks.add(h)),this.syncActiveElementStatus())},100)}deleteActiveBlocks(){var t;const e=Array.from(this.activeBlocks.values()),o=(t=e[0])==null?void 0:t.ownerSlot;if(!o)return!1;const n=e[0].index,i=new rt({type:"cut",blocks:e,ctx:this,slot:o});if(o.info.onCut==null||o.info.onCut(i),this.emit("cut",i),i.returnValue){const s=W(o.items,c=>c.index===n);s&&this.addBlockToSelection(s)}return i.returnValue}activeNextBlock(t,e=!1){const o=e&&this.options.multipleSelect;this.focus();let n=!0,i=Array.from(this.activeBlocks);var s;if(!i.length&&(i=Array.from(((s=this.activeSlot)==null?void 0:s.items)||[]),n=!1,!i.length))return;const c=i[0].ownerSlot;let r=i[0].index,h=r,v=i[0],u=v;i.slice(1).forEach(f=>{if(f.ownerSlot!==c)return;const m=f.index;m>r&&(r=m,v=f),m<h&&(h=m,u=f)});const d=t>0?r+t:h+t,g=W(c==null?void 0:c.items,f=>f.index===d);g?(o||this.activeBlocks.clear(),this.activeBlocks.add(g),this.activeSlot=c,this.syncActiveElementStatus()):n?o||(this.activeBlocks.clear(),i.length>1&&this.activeBlocks.add(t>0?v:u),this.syncActiveElementStatus()):(this.activeBlocks.clear(),o?i.forEach(f=>this.activeBlocks.add(f)):this.activeBlocks.add(t>0?u:v),this.syncActiveElementStatus())}activeParentBlock(){var t;const e=(t=this.activeSlot)==null?void 0:t.ownerBlock;this.activeSlot=(e==null?void 0:e.ownerSlot)||null,this.activeBlocks.clear(),e&&this.activeBlocks.add(e),this.syncActiveElementStatus()}activeChildrenBlocks(){const t=b(this.activeBlocks),e=b(t==null?void 0:t.slots);if(e){if(this.activeSlot=e,this.activeBlocks.clear(),this.options.multipleSelect)e.items.forEach(o=>this.activeBlocks.add(o));else{const o=b(e.items);o&&this.activeBlocks.add(o)}this.syncActiveElementStatus()}}syncActiveElementStatus(){var t;let e=!1;const o=this.lastActiveBlocks,n=this.lastActiveSlot,i=Array.from(this.activeBlocks),s=((t=i[0])==null?void 0:t.ownerSlot)||null;var c;i.length>1&&s!==this.activeSlot&&(this.activeSlot=s),!this.activeSlot&&s&&(this.activeSlot=s),i.forEach((r,h)=>{o==null||o.delete(r),e=r.setSelectStatus(h)||e}),o==null||o.forEach(r=>{e=r.setSelectStatus(!1)||e}),this.activeSlot!==n&&(n==null||n.setActive(!1),(c=this.activeSlot)==null||c.setActive(!0),this.lastActiveSlot=this.activeSlot,e=!0),this.lastActiveBlocks=new Set(this.activeBlocks),this.slotOfActiveBlocks=s,e&&this.emit("activeElementChanged",this)}clearSelection(){this.activeBlocks.clear(),this.activeSlot=null,this.syncActiveElementStatus()}addBlockToSelection(t,e="none"){if(typeof e=="object"&&(e=e.ctrlKey||e.metaKey?"ctrl":e.shiftKey?"shift":"none"),this.options.multipleSelect||(e="none"),e==="none")this.activeBlocks.clear(),this.activeBlocks.add(t);else{const o=b(this.activeBlocks);if(o&&o.ownerSlot!==t.ownerSlot){const n=[];for(let s=o;s&&s.ownerSlot;)n.push(s.ownerSlot),s=s.ownerSlot.ownerBlock;let i=-1;for(let s=t;s&&s.ownerSlot;s=s.ownerSlot.ownerBlock)if((i=n.indexOf(s.ownerSlot))!==-1){t=s;break}i===-1?this.activeBlocks.clear():i>0&&(this.activeBlocks=new Set(Array.from(this.activeBlocks,s=>{for(let c=i;c>0;c--,s=s.ownerSlot.ownerBlock);return s})))}this.activeSlot=t.ownerSlot||null,this.activeSlot||(e="ctrl")}if(e==="ctrl"&&this.activeBlocks.add(t),e==="shift"){const o=this.activeSlot,n=t.index;let i=n,s=n;this.activeBlocks.forEach(c=>{const r=c.index;i>r&&(i=r),s<r&&(s=r)}),this.activeBlocks=new Set(Array.from(o.items).filter(c=>{const r=c.index;return r>=i&&r<=s}).sort((c,r)=>c.index-r.index))}this.syncActiveElementStatus()}dispose(){var t;this.dragging.dispose(),(t=this.hiddenInput.parentElement)==null||t.removeChild(this.hiddenInput),document.removeEventListener("pointerup",this.handleGlobalPointerUp,!1)}createBlock(t,e=null){return new ut(this,e,t)}createSlot(t,e=null){return new St(this,e,t)}}const yt=()=>[{name:"aaa"},{name:"bbb",children:[{name:"b1"},{name:"b2"}]},{name:"ccc"}],bt=l=>{const t=[...l],e={};return{root:t,copiedBlocks:e,getSlotAndBlock(o){let n=t,i=null,s="";return o.forEach(c=>{if(s+=`/${c}`,!(s in e)){const r=n[c],h=F(k({},r),{children:[...r.children||[]]});n[c]=h,e[s]=h}i=e[s],n=i.children}),{slot:n,block:i}}}},wt=(l,t)=>{if("__demo_wholeReplace__"in t)return t.__demo_wholeReplace__;const e=bt(l),{slot:o,block:n}=e.getSlotAndBlock(t.path);if(t.rename&&n&&(n.name=t.rename.name),t.insert&&o.splice(t.insert.index,0,...t.insert.items),t.remove&&P(o,t.remove.indexes),t.moveInSlot){const{fromIndexes:i,toIndex:s}=t.moveInSlot;gt(o,i,s)}if(t.moveBetweenSlots){const{fromPath:i,fromIndexes:s,toIndex:c}=t.moveBetweenSlots,r=e.getSlotAndBlock(i).slot;pt(r,s,o,c)}return console.log("store reducer called",t,e),e.root},j=C(null),Dt=l=>{const t=U(wt,null,yt);return a(j.Provider,{value:t},l.children)},D=()=>T(j),R=C(null),J=()=>T(R),At=R.Provider,A=C(null);A.displayName="OwnerSlot";const Et=()=>T(A),Ct=A.Provider;A.Consumer;const O=l=>{const t=w(l);t.current=l,I(()=>()=>t.current(),[])},X=()=>{const[,l]=U(t=>(t+1)%16777215,0);return l},Tt=l=>k({},l),It=l=>k({},l),B=l=>{const t=[];for(;l;)t.unshift(l.index),l=l.ownerSlot.ownerBlock;return t},E=(...l)=>l.filter(t=>!!t).map(t=>Array.isArray(t)?E(t):String(t)).join(" "),Y=L(function(t){var u;const e=t.ownerBlock||null,[,o]=D(),n=X(),i=J(),s=y(()=>i.createSlot({onCut:d=>o({path:B(e),remove:{indexes:d.blocks.map(g=>g.index)}}),onPaste:d=>o({path:B(e),insert:{index:d.index,items:d.data.blocksData.map(Tt)}}),onActiveStatusChange:()=>n(),onDragHoverStatusChange:()=>n(),onMoveInSlot:d=>o({path:B(e),moveInSlot:{fromIndexes:d.blocks.map(g=>g.index),toIndex:d.index}}),onMoveToThisSlot:d=>{var g;return o({path:B(e),moveBetweenSlots:{fromPath:B((g=d.fromSlot)==null?void 0:g.ownerBlock),fromIndexes:d.blocks.map(f=>f.index),toIndex:d.index}})}},e),[]);O(()=>s.dispose());const c=S(d=>{s.handlePointerUp(),document.activeElement===d.currentTarget&&s.ctx.focus()},[]),r=y(()=>i.dragging.getDefaultSlotEventHandlers(s,"react"),[]),{isActive:h,isDragHovering:v}=s;return a("div",k({className:E("mySlot",h&&"isActive",v&&"isDragHovering"),tabIndex:-1,onPointerUp:c},r),a(Ct,{value:s},((u=t.children)==null?void 0:u.length)>0?t.children:a("div",{className:"mySlot-emptyPlaceholder"},"Nothing")),s.isDragHovering&&a("div",{className:"mySlot-indexToDrop",key:"indexToDrop",style:{"grid-row-start":s.indexToDrop+1}},`indexToDrop = ${s.indexToDrop}`))}),Ht=L(function l(t){var g;const{index:e,item:o}=t,n=X(),i=w();tt(i,()=>({index:e,item:o}),[e,o]);const s=J(),c=Et(),r=y(()=>s.createBlock({data:()=>It(i.current.item),index:()=>i.current.index,onActiveStatusChange:()=>n()},c),[]);O(()=>r.dispose());const h=S(f=>{r.handlePointerUp(),document.activeElement===f.currentTarget&&r.ctx.focus()},[]),v=y(()=>s.dragging.getDefaultBlockEventHandlers(r,"react"),[]),{activeNumber:u,isActive:d}=r;return a("div",k({className:E("myBlock",d&&"isActive"),tabIndex:-1,onPointerUp:h,draggable:!0},v),d&&a("div",{className:"myBlock-selectIndex"},u+1),a(Pt,{name:o.name,blockHandler:r}),a(Y,{ownerBlock:r},((g=o.children)==null?void 0:g.length)?o.children.map((f,m)=>a(l,{key:m,index:m,item:f})):null))}),Pt=l=>{const[,t]=D(),e=S(o=>{const n=l.blockHandler,i=B(n),s=o.currentTarget.value;t({path:i,rename:{name:s}})},[]);return a("input",{className:"blockNameInput",type:"text",value:l.name,onChange:e})},Ot=()=>{const[l,t]=D(),e=w(null);I(()=>{e.current.value=JSON.stringify(l,null,2)},[l]);const o=w(null);o.current=l;const n=S((c=!0)=>{try{const r=JSON.parse(e.current.value);t({path:[],__demo_wholeReplace__:r})}catch(r){c&&(e.current.value=JSON.stringify(o.current,null,2)),console.error("Failed to replace: ",r)}},[]),i=S(()=>n(!0),[]),s=S(()=>n(!1),[]);return a("div",null,a("ul",null,a("li",null,"Click to select block / slot"),a("li",null,"Drag and drop. Also supports cross-window dragging."),a("li",null,"Copy, Cut, Paste with ",a("kbd",null,"Ctrl+C")," / ",a("kbd",null,"Ctrl+X")," / ",a("kbd",null,"Ctrl+V")),a("li",null,"Navigate between blocks with arrow keys"),a("li",null,"Select multiple blocks with ",a("kbd",null,"Ctrl")," or ",a("kbd",null,"Shift"))),a("h3",null,"Current Store"),a("textarea",{class:"demoPage-store",spellcheck:!1,ref:e,onBlur:i,onInput:s}))},_t=function(){const[l]=D(),[t,e]=et(!1),o=y(()=>new Bt,[]);return O(()=>o.dispose()),I(()=>{o.on("focus",()=>e(!0)),o.on("blur",()=>e(!1)),o.on("paste",n=>{console.log("pasting...",n)})},[]),a(At,{value:o},Ut,a("div",{className:E("demoPage",t&&"hasFocus")},a("div",{className:"demoPage-blockArea"},a(Y,null,l.map((n,i)=>a(Ht,{key:i,index:i,item:n})))),a("div",{className:"demoPage-introductionArea"},a(Ot,null))))},Nt="https://github.com/lyonbot/interactive-blocks",Ft="https://lyonbot.github.io/interactive-blocks/docs/",Ut=a(ot,null,a("h2",null,"InteractiveBlocks"),a("p",null,"Just proving the abilities with shabby Slot and Block components here."),a("p",null,"Learn how to integrate with your own components? ",a("a",{href:Ft,target:"_blank"},"Read the Document \xBB")),a("a",{className:"demoPage-forkMe",href:Nt,target:"_blank"},"Fork me on GitHub"));it(a(Dt,null,a(_t,null)),document.getElementById("app"));
